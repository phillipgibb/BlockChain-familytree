var fs = require('fs');
var contract = require("truffle-contract");
import getTransactionReceiptMined from './getTransactionReceiptMined';

export default class FamilyTreeWrapper {

  constructor(web3) {
    this.contractInstance;
    this.web3 = web3;
    this.familyTreeABI = [{"constant":false,"inputs":[{"name":"otherSpouseId","type":"int128"},{"name":"firstName","type":"bytes18"},{"name":"lastName","type":"bytes18"},{"name":"gender","type":"bytes6"},{"name":"dateOfBirth","type":"int128"},{"name":"dateOfDeath","type":"int128"}],"name":"addSpouse","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"id","type":"int128"}],"name":"getChildren","outputs":[{"name":"children","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"parentId","type":"int128"},{"name":"firstName","type":"bytes18"},{"name":"lastName","type":"bytes18"},{"name":"gender","type":"bytes6"},{"name":"dateOfBirth","type":"int128"},{"name":"dateOfDeath","type":"int128"}],"name":"addChild","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"int128"},{"name":"dateOfDeath","type":"int128"}],"name":"funeral","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"childId","type":"int128"},{"name":"firstName","type":"bytes18"},{"name":"lastName","type":"bytes18"},{"name":"gender","type":"bytes6"},{"name":"dateOfBirth","type":"int128"},{"name":"dateOfDeath","type":"int128"}],"name":"addFather","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getNumberOfFamilyMembers","outputs":[{"name":"","type":"int128"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"id","type":"int128"}],"name":"getNode","outputs":[{"name":"firstName","type":"bytes18"},{"name":"lastName","type":"bytes18"},{"name":"gender","type":"bytes6"},{"name":"dateOfBirth","type":"int128"},{"name":"spouseId","type":"int128"},{"name":"dateOfDeath","type":"int128"},{"name":"noOfChildren","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"firstName","type":"bytes18"},{"name":"lastName","type":"bytes18"},{"name":"gender","type":"bytes6"},{"name":"dateOfBirth","type":"int128"},{"name":"dateOfDeath","type":"int128"}],"name":"addFamilyMember","outputs":[{"name":"id","type":"int128"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"int128"}],"name":"deleteFamilyMember","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"childId","type":"int128"},{"name":"firstName","type":"bytes18"},{"name":"lastName","type":"bytes18"},{"name":"gender","type":"bytes6"},{"name":"dateOfBirth","type":"int128"},{"name":"dateOfDeath","type":"int128"}],"name":"addMother","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"array","type":"int128[]"}],"name":"arrayToCsvString","outputs":[{"name":"arrayString","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"spouseId","type":"int128"},{"name":"otherSpouseId","type":"int128"}],"name":"divorse","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"id","type":"int128"}],"name":"getFullName","outputs":[{"name":"","type":"bytes18"},{"name":"","type":"bytes18"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"firstName","type":"bytes18"},{"name":"lastName","type":"bytes18"},{"name":"gender","type":"bytes6"},{"name":"dateOfBirth","type":"int128"}],"payable":true,"stateMutability":"payable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"fromAddress","type":"address"},{"indexed":false,"name":"firstName","type":"bytes18"},{"indexed":false,"name":"lastName","type":"bytes18"}],"name":"FamilyCreated","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"fromAddress","type":"address"},{"indexed":false,"name":"firstName","type":"bytes18"},{"indexed":false,"name":"lastName","type":"bytes18"},{"indexed":false,"name":"gender","type":"bytes6"}],"name":"FamilyMemberAdded","type":"event"}];
    this.familyTreeByteCode = "0x60606040526040516080806200241c8339810160405280805191906020018051919060200180519190602001805191506200003b905062000365565b6200004562000365565b6200004f62000377565b60008054600160a060020a033316600160a060020a0319909116179055600280546001608060020a0319166001176001608060020a0316700100000000000000000000000000000000179055610140604051908101604090815260008083526001607060020a0319808b16602080860191909152908a16928401929092527fffffffffffff0000000000000000000000000000000000000000000000000000881660608401526000196080840152600f87900b60a084015260c0830181905260e08301859052610100830181905261012083018690528052600190529050807fa6eef7e35abe7026729641147f7915573c7e97b47efa546f5f6e3230263bcb4981518154600f9190910b6001608060020a03166001608060020a031990911617815560208201516001820180546001609060020a0319166e01000000000000000000000000000090920491909117905560408201516002820180546001609060020a0319166e01000000000000000000000000000090920491909117905560608201516002820180547a010000000000000000000000000000000000000000000000000000909204720100000000000000000000000000000000000002609060020a60c060020a03199092169190911790556080820151600382018054600f9290920b6001608060020a03166001608060020a031990921691909117905560a08201518160030160106101000a8154816001608060020a030219169083600f0b6001608060020a0316021790555060c0820151600482018054600f9290920b6001608060020a03166001608060020a031990921691909117905560e082015181600501908051620002c5929160200190620003da565b50610100820151816006015561012082015181600701908051620002ee929160200190620003da565b50506000547fdbe9b6cf797a9e3afb04dda5c8eae8de7ea7c611a5234cdf510daaf618b34b909150600160a060020a03168888604051600160a060020a0390931683526001607060020a03199182166020840152166040808301919091526060909101905180910390a150505050505050620004c6565b60206040519081016040526000815290565b6101406040519081016040908152600080835260208301819052908201819052606082018190526080820181905260a0820181905260c082015260e08101620003bf62000365565b815260200160008152602001620003d562000365565b905290565b828054828255906000526020600020906001016002900481019282156200048a5791602002820160005b838211156200045357835183826101000a8154816001608060020a030219169083600f0b6001608060020a031602179055509260200192601001602081600f0104928301926001030262000404565b8015620004885782816101000a8154906001608060020a030219169055601001602081600f0104928301926001030262000453565b505b50620004989291506200049c565b5090565b620004c391905b80821115620004985780546001608060020a0319168155600101620004a3565b90565b611f4680620004d66000396000f3006060604052600436106100cf5763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416630f38380681146100d1578063152e02521461011c5780631637de89146101ac5780632bbcf8a6146101f757806341c0e1b5146102185780635d28da111461022b57806360fbf745146102765780636d244b69146102a25780636e4105051461031d5780636f12cb941461035e5780639b8aa6751461022b578063a0b7ab5d1461038b578063c357b111146103da578063f713dda0146103fb575b005b34156100dc57600080fd5b6100cf600435600f90810b906001607060020a031960243581169160443590911690600160d060020a03196064351690608435810b9060a435900b610439565b341561012757600080fd5b610135600435600f0b6104aa565b60405160208082528190810183818151815260200191508051906020019080838360005b83811015610171578082015183820152602001610159565b50505050905090810190601f16801561019e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156101b757600080fd5b6100cf600435600f90810b906001607060020a031960243581169160443590911690600160d060020a03196064351690608435810b9060a435900b61069f565b341561020257600080fd5b6100cf600435600f90810b90602435900b61086c565b341561022357600080fd5b6100cf6108ad565b341561023657600080fd5b6100cf600435600f90810b906001607060020a031960243581169160443590911690600160d060020a03196064351690608435810b9060a435900b6108ee565b341561028157600080fd5b6102896109e8565b604051600f91820b90910b815260200160405180910390f35b34156102ad57600080fd5b6102bb600435600f0b6109f9565b6040516001607060020a03199788168152959096166020860152600160d060020a0319909316604080860191909152600f92830b830b606086015290820b820b608085015291810b900b60a083015260c082019290925260e001905180910390f35b341561032857600080fd5b6102896001607060020a031960043581169060243516600160d060020a031960443516606435600f90810b90608435900b610c0f565b341561036957600080fd5b610377600435600f0b610dc2565b604051901515815260200160405180910390f35b341561039657600080fd5b610135600460248135818101908301358060208181020160405190810160405280939291908181526020018383602002808284375094965061113695505050505050565b34156103e557600080fd5b6100cf600435600f90810b90602435900b611261565b341561040657600080fd5b610414600435600f0b6112b7565b6040516001607060020a03199283168152911660208201526040908101905180910390f35b60006104488686868686610c0f565b600f97880b80890b600090815260016020526040808220600390810180546fffffffffffffffffffffffffffffffff199081166001608060020a03978f0b888116919091179092559c0b83529120018054909916911617909655505050505050565b6104b2611e13565b6104ba611e25565b6104c2611e13565b6001600085600f0b600f0b815260200190815260200160002061014060405190810160409081528254600f90810b810b810b83526001840154607060020a9081026001607060020a0319908116602080870191909152600287015492830290911684860152609060020a90910460d060020a02600160d060020a0319166060850152600385015480830b830b830b6080860152608060020a9004820b820b820b60a08501526004850154820b820b90910b60c084015260058401805493949360e08601939192909182820290910190519081016040528092919081815260200182805480156105f657602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f010492830192600103820291508084116105bf5790505b50505050508152602001600682015481526020016007820180548060200260200160405190810160405280929190818152602001828054801561067e57602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f010492830192600103820291508084116106475790505b5050505050815250509150610697826101200151611136565b949350505050565b6000806106af8787878787610c0f565b600f89810b900b600090815260016020526040902090925090506106d3888361149d565b151561079c57600781018054600181016106ed8382611e84565b506000918252602080832060028084049091018054919093066010026101000a6001608060020a0381810219909216600f88810b93841692909202179093556006850180546001908101909155920b835281905260409091206005018054909181016107598382611e84565b91600052602060002090600291828204019190066010028a909190916101000a8154816001608060020a030219169083600f0b6001608060020a03160217905550505b60038101546000600f91820b90910b1380156107c7575060038101546107c590600f0b8361149d565b155b15610862576003810154600f90810b810b900b60009081526001602081905260409091206007018054909181016107fe8382611e84565b506000918252602080832060028084049091018054919093066010026101000a6001608060020a0381810219909216600f88810b9390931691909102179092556003840154820b820b90910b82526001908190526040909120600601805490910190555b5050505050505050565b600f91820b820b600090815260016020526040902060040180549190920b6001608060020a03166fffffffffffffffffffffffffffffffff19909116179055565b6000543373ffffffffffffffffffffffffffffffffffffffff908116911614156108ec5760005473ffffffffffffffffffffffffffffffffffffffff16ff5b565b60006108fd8686868686610c0f565b90506001600088600f0b600f0b8152602001908152602001600020600501805480600101828161092d9190611e84565b916000526020600020906002918282040191900660100283909190916101000a8154816001608060020a030219169083600f0b6001608060020a03160217905550506001600082600f0b600f0b8152602001908152602001600020600701805480600101828161099d9190611e84565b916000526020600020906002918282040191900660100289909190916101000a8154816001608060020a030219169083600f0b6001608060020a031602179055505050505050505050565b600254608060020a9004600f0b5b90565b6000806000806000806000610a0c611e25565b600160008a600f0b600f0b815260200190815260200160002061014060405190810160409081528254600f90810b810b810b83526001840154607060020a9081026001607060020a0319908116602080870191909152600287015492830290911684860152609060020a90910460d060020a02600160d060020a0319166060850152600385015480830b830b830b6080860152608060020a9004820b820b820b60a08501526004850154820b820b90910b60c084015260058401805493949360e0860193919290918282029091019051908101604052809291908181526020018280548015610b4057602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f01049283019260010382029150808411610b095790505b505050505081526020016006820154815260200160078201805480602002602001604051908101604052809291908181526020018280548015610bc857602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f01049283019260010382029150808411610b915790505b50505050508152505090508060200151816040015182606001518360a0015184608001518560c00151866101000151959f949e50929c50909a509850965090945092505050565b60028054600f90810b810b810b6000908152600160208190526040808320918201805471ffffffffffffffffffffffffffffffffffff19908116607060020a808e04919091179092559583018054909616908a041777ffffffffffff0000000000000000000000000000000000001916609060020a60d060020a8a0402179094556003810180546004830180546fffffffffffffffffffffffffffffffff199081166001608060020a038a890b811691909117909255918116608060020a968a900b821696909602959095171690931790925560068201819055917f30efdade7c171559e8d39c25ce62f563a6a91638cd14ea6f6e3e7cb55d7c3c4c9033908990899089905173ffffffffffffffffffffffffffffffffffffffff90941684526001607060020a031992831660208501529116604080840191909152600160d060020a031990911660608301526080909101905180910390a15050600280546fffffffffffffffffffffffffffffffff196001608060020a03808316608060020a93849004600f90810b6001908101820b84169095029190911792831692810b938401900b161790915595945050505050565b6000610dcc611e25565b6000806000806001600088600f0b600f0b815260200190815260200160002061014060405190810160409081528254600f90810b810b810b83526001840154607060020a9081026001607060020a0319908116602080870191909152600287015492830290911684860152609060020a90910460d060020a02600160d060020a0319166060850152600385015480830b830b830b6080860152608060020a9004820b820b820b60a08501526004850154820b820b90910b60c084015260058401805493949360e0860193919290918282029091019051908101604052809291908181526020018280548015610f0657602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f01049283019260010382029150808411610ecf5790505b505050505081526020016006820154815260200160078201805480602002602001604051908101604052809291908181526020018280548015610f8e57602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f01049283019260010382029150808411610f575790505b5050505050815250509450600093505b8460e0015151841015610fdd578460e001518481518110610fbb57fe5b906020019060200201519250610fd183886116c8565b50600190930192610f9e565b600091505b8461012001515182101561102357846101200151828151811061100157fe5b906020019060200201519050611017818861194a565b50600190910190610fe2565b6000198560800151600f0b131561107f57600019600160008760800151600f0b600f0b815260200190815260200160002060030160006101000a8154816001608060020a030219169083600f0b6001608060020a031602179055505b600f87810b900b6000908152600160208190526040822080546fffffffffffffffffffffffffffffffff199081168255918101805471ffffffffffffffffffffffffffffffffffff1916905560028101805477ffffffffffffffffffffffffffffffffffffffffffffffff19169055600381018390556004810180549092169091559061110f6005830182611ebd565b60068201600090556007820160006111279190611ebd565b50600198975050505050505050565b61113e611e13565b6000611148611e13565b611150611ee5565b611158611ee5565b611160611ee5565b60009450602060405190810160405280600081525093506111b360408051908101604052600181527f2c000000000000000000000000000000000000000000000000000000000000006020820152611bd4565b92505b8651856001608060020a03161015611256576111d184611bd4565b91506111dc82611bfc565b1515611230576111f46111ef8385611c07565b611bd4565b9050611229816112246111ef8a896001608060020a03168151811061121557fe5b90602001906020020151611c73565b611c07565b935061124b565b61124887866001608060020a03168151811061121557fe5b93505b6001909401936111b6565b509195945050505050565b600f91820b820b600090815260016020526040808220600390810180546001608060020a036fffffffffffffffffffffffffffffffff19918216811790925594860b90950b835291200180549091169091179055565b6000806112c2611e25565b6001600085600f0b600f0b815260200190815260200160002061014060405190810160409081528254600f90810b810b810b83526001840154607060020a9081026001607060020a0319908116602080870191909152600287015492830290911684860152609060020a90910460d060020a02600160d060020a0319166060850152600385015480830b830b830b6080860152608060020a9004820b820b820b60a08501526004850154820b820b90910b60c084015260058401805493949360e08601939192909182820290910190519081016040528092919081815260200182805480156113f657602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f010492830192600103820291508084116113bf5790505b50505050508152602001600682015481526020016007820180548060200260200160405190810160405280929190818152602001828054801561147e57602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f010492830192600103820291508084116114475790505b5050505050815250509050806020015181604001519250925050915091565b60006114a7611e25565b600f84810b900b6000908152600160205260408082208291610140905190810160409081528254600f90810b810b810b83526001840154607060020a9081026001607060020a0319908116602080870191909152600287015492830290911684860152609060020a90910460d060020a02600160d060020a0319166060850152600385015480830b830b830b6080860152608060020a9004820b820b820b60a08501526004850154820b820b90910b60c084015260058401805493949360e08601939192909182820290910190519081016040528092919081815260200182805480156115d957602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f010492830192600103820291508084116115a25790505b50505050508152602001600682015481526020016007820180548060200260200160405190810160405280929190818152602001828054801561166157602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f0104928301926001038202915080841161162a5790505b50505050508152505092508261010001519150600090505b818110156116ba5784600f0b836101200151828151811061169657fe5b90602001906020020151600f0b14156116b257600193506116bf565b600101611679565b600093505b50505092915050565b60006116d2611e25565b600f84810b900b6000908152600160205260408082208291610140905190810160409081528254600f90810b810b810b83526001840154607060020a9081026001607060020a0319908116602080870191909152600287015492830290911684860152609060020a90910460d060020a02600160d060020a0319166060850152600385015480830b830b830b6080860152608060020a9004820b820b820b60a08501526004850154820b820b90910b60c084015260058401805493949360e086019391929091828202909101905190810160405280929190818152602001828054801561180457602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f010492830192600103820291508084116117cd5790505b50505050508152602001600682015481526020016007820180548060200260200160405190810160405280929190818152602001828054801561188c57602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f010492830192600103820291508084116118555790505b50505050508152505092508261010001519150600090505b818110156116ba5784600f0b83610120015182815181106118c157fe5b90602001906020020151600f0b141561194257600f86810b900b600090815260016020526040902060070180546000199190839081106118fd57fe5b90600052602060002090600291828204019190066010026101000a8154816001608060020a030219169083600f0b6001608060020a03160217905550600193506116bf565b6001016118a4565b6000611954611e25565b600f84810b900b60009081526001602052604080822090610140905190810160409081528254600f90810b810b810b83526001840154607060020a9081026001607060020a0319908116602080870191909152600287015492830290911684860152609060020a90910460d060020a02600160d060020a0319166060850152600385015480830b830b830b6080860152608060020a9004820b820b820b60a08501526004850154820b820b90910b60c084015260058401805493949360e0860193919290918282029091019051908101604052809291908181526020018280548015611a8557602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f01049283019260010382029150808411611a4e5790505b505050505081526020016006820154815260200160078201805480602002602001604051908101604052809291908181526020018280548015611b0d57602002820191906000526020600020906000905b82829054906101000a9004600f0b600f0b81526020019060100190602082600f01049283019260010382029150808411611ad65790505b5050505050815250509150600090505b8160e0015151811015611bc75783600f0b8260e001518281518110611b3e57fe5b90602001906020020151600f0b1415611bbf57600f85810b900b60009081526001602052604090206005018054600019919083908110611b7a57fe5b90600052602060002090600291828204019190066010026101000a8154816001608060020a030219169083600f0b6001608060020a0316021790555060019250611bcc565b600101611b1d565b600092505b505092915050565b611bdc611ee5565b602082016040805190810160405280845181526020019190915292915050565b600081511592915050565b611c0f611e13565b611c17611e13565b60008351855101604051805910611c2b5750595b818152601f19601f830116810160200160405290509150602082019050611c588186602001518751611dce565b611c6b8551820185602001518651611dce565b509392505050565b611c7b611e13565b6000611c85611e13565b600080611c90611e13565b60006064955085604051805910611ca45750595b818152601f19601f830116810160200160405290509450600093505b600f88900b15611d2b57600a600f9890980b8881059860018601959107935060f860020a603085010290869081518110611cf657fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350611cc0565b83600101604051805910611d3c5750595b818152601f19601f830116810160200160405290509150600090505b838111611dc3578481850381518110611d6d57fe5b016020015160f860020a900460f860020a02828281518110611d8b57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350600101611d58565b509695505050505050565b60005b60208210611df45782518452602084019350602083019250602082039150611dd1565b6001826020036101000a03905080198351168185511617909352505050565b60206040519081016040526000815290565b6101406040519081016040908152600080835260208301819052908201819052606082018190526080820181905260a0820181905260c082015260e08101611e6b611e13565b815260200160008152602001611e7f611e13565b905290565b815481835581811511611eb8576001016002900481600101600290048360005260206000209182019101611eb89190611efc565b505050565b508054600082556001016002900490600052602060002090810190611ee29190611efc565b50565b604080519081016040526000808252602082015290565b6109f691905b80821115611f165760008155600101611f02565b50905600a165627a7a723058200e62dc1a5342c3d6024a16e16e4c364b539a911df074e66d01df3af55b491f7f0029";

  }

  initialize() {
    console.log("Initializing");
    this.familyTreeContract = this.web3.eth.contract(this.familyTreeABI);
  }

  estimateGas(params) {
    const estimateGasAsync = (resolve, reject) => {
      this.web3.eth.estimateGas(
        params,
        (error, estimatedGas) => {
          if (error) {
            reject(error)
          } else {
            resolve(estimatedGas)
          }
        }
      )
    }
    return new Promise(estimateGasAsync)
  }

  findContract(contractAddress) {
    var contract = this.web3.eth.contract(this.familyTreeABI);
    this.contractInstance = contract.at(contractAddress);
    return this.contractInstance;
  }

  async newFamilyTree(address, firstName, lastName, gender, dob) {
    console.log("DATE OF BIRTH: " + dob);
    console.log("firstName: " + firstName);
    console.log("lastName: " + lastName);
    console.log("gender: " + gender);
    this.deployedContract = await this.familyTreeContract.new(firstName, lastName, gender, dob, { from: address, gas: 3000000, data: this.familyTreeByteCode }, (contractError, contractResult) => {
      if (!contractError && contractResult) {
        if (!contractResult.contractAddress) {
          App.showMessage('Please wait for Contract to be Mined ...', 'info');
          getTransactionReceiptMined(contractResult.transactionHash, 500).then(function (receipt) {
            App.displayNewFamilyTree(receipt);
            return receipt;
          });
        } else {
          App.displayNewFamilyResult(contractResult);
           return contractResult;
        }
      } else if (contractError) {
        App.showMessage("Contract Creation Error: " + contractError, 'danger');
        return contractError;
      }
    });
    return this.deployedContract;
  }

  async getNumberOfFamilyMembers(callback) {
    return await this.contractInstance.getNumberOfFamilyMembers.call(callback);
  }

  async addFamilyMember(addFromId, ownerAddress, firstName, lastName, gender, familyMemberType, dob, dod) {

    var options = { from: ownerAddress, gas: 3000000, data: this.familyTreeByteCode };
    // var id = await this.contractInstance.addFamilyMember(firstName, lastName, gender, dob,dod, options, addFamilyMemberCallback);

    const addFamilyMemberCallback = (contractError, contractResult) => {
      if (!contractError && contractResult) {
        if (!contractResult) {
          App.showMessage('Please wait for Contract to be Mined ...', 'info');
          getTransactionReceiptMined(contractResult.transactionHash, 500).then(function (receipt, error) {
            if (!error) {
              var message = "Family Member Added with ";
              message += "Transaction Hash: " + receipt;
              App.showMessage(message, 'success');
              //need funtion to add to  App.familyTreeStructure
              App.makeTree();
              return receipt;
            } else {
              App.showMessage("Contract Creation Error: " + error, 'danger');
              return error;
            }
          });
        } else {
          var message = "Family Member Added with ";
          message += "Transaction Hash: " + contractResult;
          App.showMessage(message, 'success');
          App.makeTree();
          return contractResult;
        }
      } else if (contractError) {
        App.showMessage("Contract Creation Error: " + contractError, 'danger');
        return contractError;
      }
    }

    if (!familyMemberType) {
      await this.contractInstance.addFamilyMember(firstName, lastName, gender, dob, dod, options, addFamilyMemberCallback);
    } else if (familyMemberType === 'Spouse') {
      await this.contractInstance.addSpouse(addFromId, firstName, lastName, gender, dob, dod, options, addFamilyMemberCallback);
    } else if (familyMemberType === 'Child') {
      await this.contractInstance.addChild(addFromId, firstName, lastName, gender, dob, dod, options, addFamilyMemberCallback);
    } else if (familyMemberType === 'Parent') {
      if (gender === 'Male') {
        await this.contractInstance.addFather(addFromId, firstName, lastName, gender, dob, dod, options, addFamilyMemberCallback);
      } else {
        await this.contractInstance.addMother(addFromId, firstName, lastName, gender, dob, dod, options, addFamilyMemberCallback);
      }
    }

    return this.deployedContract;
  }

}

// We need to wait until any miner has included the transaction
  // in a block to get the address of the contract
  //this method seems to be out of scope otherwise I would use it
 /* waitForContractToBeMined(contract){
    console.log('waiting for contract to be mined');
    const receipt = web3.eth.getTransactionReceipt(contract.transactionHash);
    // If no receipt, try again in 1s
    if (receipt == null) {
        setTimeout(() => {
            waitForTransactionReceipt(contract);
        }, 1000);
    } else {
        // The transaction was mined, we can retrieve the contract address
        console.log('contract address: ' + receipt.contractAddress);
        return receipt.contractAddress;
    }
  }

  getTransactionReceiptMined(txHash, interval) {
    const self = web3.eth;
    const transactionReceiptAsync = function (resolve, reject) {
      self.getTransactionReceipt(txHash, (error, receipt) => {
        if (error) {
          reject(error);
        } else if (receipt == null) {
          setTimeout(
            () => transactionReceiptAsync(resolve, reject),
            interval ? interval : 500);
        } else {
          resolve(receipt);
        }
      });
    };

    if (Array.isArray(txHash)) {
      return Promise.all(txHash.map(
        oneTxHash => self.getTransactionReceiptMined(oneTxHash, interval)));
    } else if (typeof txHash === "string") {
      return new Promise(transactionReceiptAsync);
    } else {
      throw new Error("Invalid Type: " + txHash);
    }
  };
*/


  // hexEncode(string){
  //   var hex, i;
  //   var result = "";
  //   for (i=0; i<this.length; i++) {
  //       hex = this.charCodeAt(i).toString(16);
  //       result += ("000"+hex).slice(-4);
  //   }
  //   return result
  // }
